<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Forwarder Admin Panel</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:600,400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            background: #f7f9fb;
            margin: 0;
        }
        .container {
            max-width: 820px;
            margin: 32px auto;
        }
        .block {
            background: #fff;
            border-radius: 14px;
            margin-bottom: 30px;
            padding: 26px 32px 22px 32px;
            box-shadow: 0 6px 32px #0001;
            transition: box-shadow 0.2s;
        }
        .block:hover {
            box-shadow: 0 8px 40px #0002;
        }
        h2 {
            font-size: 2rem;
            margin-top: 0;
            margin-bottom: 18px;
            font-weight: 600;
            letter-spacing: -1px;
        }
        label, .label {
            font-size: 1.07rem;
            color: #393939;
            font-weight: 500;
        }
        input[type="text"], input[type="number"] {
            font-size: 1rem;
            padding: 8px 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 1.5px solid #d3d3d6;
            border-radius: 7px;
            background: #f8fafc;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #3088ee;
            background: #f3f6fb;
        }
        button {
            font-family: inherit;
            font-size: 1rem;
            padding: 8px 22px;
            background: linear-gradient(90deg, #3088ee 60%, #57b8e8 100%);
            border: none;
            border-radius: 7px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 10px #3088ee22;
            transition: background 0.2s, box-shadow 0.2s;
        }
        button:hover {
            background: linear-gradient(90deg, #57b8e8 60%, #3088ee 100%);
            box-shadow: 0 3px 18px #3088ee33;
        }
        .delbtn {
            background: #ff6161;
            color: #fff;
            font-weight: bold;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 0.97em;
            margin-left: 9px;
            box-shadow: 0 2px 8px #ff616122;
        }
        .delbtn:hover {
            background: #ff3b3b;
        }
        .info {
            color: #555;
            font-size: 1.01rem;
        }
        .logs-block {
            margin-top: 10px;
        }
        .logs-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: #202d41;
            color: #fff;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.96rem;
        }
        .logs-table th, .logs-table td {
            padding: 9px 7px;
            border: none;
            text-align: left;
        }
        .logs-table th {
            background: #253555;
            font-weight: 600;
            font-size: 1rem;
        }
        .logs-table tbody tr:nth-child(odd) {
            background: #23304a;
        }
        .logs-table tbody tr:nth-child(even) {
            background: #273858;
        }
        .mono {
            font-family: 'Fira Mono', 'Consolas', monospace;
            font-size: 0.98em;
        }
        .status-success {
            color: #7ef37e;
            font-weight: 700;
        }
        .status-fail {
            color: #ff6161;
            font-weight: 700;
        }
        .error-cell {
            color: #ff6060;
            font-size: 0.95em;
            max-width: 180px;
            word-break: break-all;
        }
        .cmdform {
            display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;
        }
        .cmdtitle {
            width: 95px; min-width: 90px; font-weight: 600; font-size: 1.08em; color: #3088ee;
        }
        .delcol {
            min-width: 60px;
        }
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è textarea –¥–ª—è –±–ª–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .sendmsg-textarea {
            flex: 1;
            min-width: 240px;
            max-width: 100%;
            min-height: 54px;
            padding: 12px 16px;
            border-radius: 9px;
            border: 1.5px solid #d3d3d6;
            font-size: 1.07rem;
            font-family: inherit;
            background: #f8fafc;
            resize: vertical;
            transition: .2s;
            box-sizing: border-box;
        }
        .sendmsg-textarea:focus {
            outline: none;
            border-color: #3088ee;
            background: #f3f6fb;
        }
        @media (max-width: 800px) {
            .container, .block { max-width: 98vw; padding: 12px 3vw 18px 3vw; }
            .logs-table th, .logs-table td { font-size: 0.92em; }
            .cmdform { flex-direction: column; align-items: stretch; gap: 4px;}
            .cmdtitle { width: auto; }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ -->
    <div class="block" style="margin-bottom:28px;">
        <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏</h2>
        <form id="sendMsgForm" style="display:flex;align-items:flex-start;gap:12px;flex-wrap:wrap;">
            <textarea name="text" required 
                class="sendmsg-textarea"
                placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–æ –≤—Å–µ –≥—Ä—É–ø–ø—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏..."></textarea>
            <button type="submit" style="height:48px;margin-top:2px;min-width:140px;">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
        <div id="sendMsgResult" style="margin-top:12px;font-size:1.07em;color:#3088ee;min-height:20px;"></div>
    </div>
    <script>
    document.getElementById('sendMsgForm').onsubmit = async function(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const btn = e.target.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.innerText = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
        const resultDiv = document.getElementById('sendMsgResult');
        resultDiv.innerText = '';
        try {
            const response = await fetch('/send_custom_message', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            if(result.ok) {
                resultDiv.innerHTML = `‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ <b>${result.sent}</b> —á–∞—Ç–æ–≤`;
            } else {
                resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${(result.errors||[]).join('; ')}`;
            }
        } catch(err) {
            resultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏.';
        }
        btn.disabled = false;
        btn.innerText = 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å';
        e.target.reset();
    };
    </script>

    <div class="block">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</h2>
        {% for cmd, cdata in config.items() %}
        <form class="cmdform" method="post" action="/set_chat">
            <span class="cmdtitle">{{cmd}}</span>
            <input type="text" name="source_chat_ids" placeholder="–ß–∞—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" value="{{cdata['source_chat_ids'] | join(',')}}" required>
            <input type="number" name="target_chat_id" placeholder="–ß–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏" value="{{cdata['target_chat_id'] or ''}}" required>
            <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" value="{{cdata['title']}}">
            <input type="hidden" name="command" value="{{cmd}}">
            <button type="submit">üíæ</button>
            {% if cmd not in ['/add','/error'] %}
            <form class="delcol" style="display:inline;" method="post" action="/delete_command">
                <input type="hidden" name="command" value="{{cmd}}">
                <button type="submit" class="delbtn" title="–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É">üóë</button>
            </form>
            {% endif %}
        </form>
        <div class="info" style="margin:-3px 0 11px 103px;">
            <b>–ò—â–µ—Ç:</b> <span class="mono">{{cdata['source_chat_ids'] | join(', ')}}</span> ‚Üí
            <b>–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:</b> <span class="mono">{{cdata['target_chat_id']}}</span>
            {% if cdata['title'] %}| <b>–ù–∞–∑–≤–∞–Ω–∏–µ:</b> <span class="mono">{{cdata['title']}}</span>{% endif %}
        </div>
        {% endfor %}
        <form method="post" action="/add_command" style="margin-top:18px;display:flex;align-items:center;gap:10px;">
            <input type="text" name="command" placeholder="–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, /support)" required style="flex:1;">
            <button type="submit" style="min-width:120px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
        </form>
    </div>
    <div class="block logs-block">
        <h2 style="font-size:1.35rem; margin-bottom:10px;">–õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏</h2>
        <div style="max-height:320px; overflow:auto; border-radius:10px;">
            <table class="logs-table">
                <thead>
                    <tr>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ö–æ–º–∞–Ω–¥–∞</th>
                        <th>–¢–µ–∫—Å—Ç</th>
                        <th>–ò–∑ —á–∞—Ç–∞</th>
                        <th>–í —á–∞—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–û—à–∏–±–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                {% for log in logs %}
                    <tr>
                        <td class="mono">{{log.time}}</td>
                        <td class="mono">{{log.command}}</td>
                        <td>{{log.text}}</td>
                        <td class="mono">{{log.from_chat}}</td>
                        <td class="mono">{{log.to_chat}}</td>
                        <td class="mono {% if log.status=='success' %}status-success{% else %}status-fail{% endif %}">
                            {{'‚úÖ' if log.status=='success' else '‚ùå'}}
                        </td>
                        <td class="mono error-cell">{% if log.error %}{{log.error}}{% endif %}</td>
                    </tr>
                {% endfor %}
                {% if logs|length == 0 %}
                    <tr><td colspan="7" style="text-align:center; opacity:0.7;">–ü–æ–∫–∞ –Ω–µ—Ç –ª–æ–≥–æ–≤</td></tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="block" style="text-align:center;">
        <b>–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –Ω—É–∂–Ω—ã–µ —á–∞—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã —á–∞—Ç—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) –∏ —á–∞—Ç-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ.<br>
        –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–æ–º–∞–Ω–¥–∞ <span class="mono">/add ...</span> (–∏–ª–∏ –ª—é–±–∞—è –¥—Ä—É–≥–∞—è) –≤ –≥—Ä—É–ø–ø–µ-–∏—Å—Ç–æ—á–Ω–∏–∫–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ —Ü–µ–ª–µ–≤–æ–π —á–∞—Ç —Å –ø—Ä–∏–ø–∏—Å–∫–æ–π <span class="mono">/add</span> (–∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–º–∞–Ω–¥–æ–π).</b>
        <br><br>
        <small>–§–∞–π–ª <code>forwarder_bot_token.txt</code> ‚Äî —Å—é–¥–∞ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞.<br>
        –§–∞–π–ª <code>forwarder_config.json</code> ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–∏.<br>
        –§–∞–π–ª <code>forwarder_forward.log</code> ‚Äî –ª–æ–≥–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–∏.</small>
    </div>
</div>
</body>
</html>
